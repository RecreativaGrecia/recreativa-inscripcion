<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inscripción Recreativa MTB - Las Mercedes de Grecia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">

  <div class="max-w-2xl mx-auto mt-10 bg-white p-8 rounded-lg shadow-lg">
    <h1 class="text-3xl font-bold text-center text-green-700 mb-6">Inscripción Recreativa MTB</h1>
    <p class="text-center text-gray-600 mb-4">Completa el siguiente formulario para inscribirte en la recreativa.</p>
    <p class="text-center text-red-600 font-bold mb-6">
      ⚠️ Las inscripciones se cierran el día sábado 27 de septiembre a las 9:00pm
    </p>

    <form id="registroForm" class="space-y-4">
      <div>
        <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>
        <input type="text" id="nombre" name="nombre" required
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
      </div>

      <div>
        <label for="apellidos" class="block text-sm font-medium text-gray-700">Apellidos</label>
        <input type="text" id="apellidos" name="apellidos" required
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
      </div>

      <div>
        <label for="cedula" class="block text-sm font-medium text-gray-700">Cédula</label>
        <input type="text" id="cedula" name="cedula" required maxlength="11" placeholder="0-0000-0000"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
      </div>

      <div>
        <label for="sexo" class="block text-sm font-medium text-gray-700">Sexo</label>
        <select id="sexo" name="sexo" required
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
          <option value="">Seleccione una opción</option>
          <option value="Masculino">Masculino</option>
          <option value="Femenino">Femenino</option>
        </select>
      </div>

      <div>
        <label for="talla" class="block text-sm font-medium text-gray-700">Talla de camiseta</label>
        <select id="talla" name="talla" required
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
          <option value="">Seleccione una talla</option>
          <option value="XS">XS</option>
          <option value="S">S</option>
          <option value="M">M</option>
          <option value="L">L</option>
          <option value="XL">XL</option>
          <option value="XXL" disabled>XXL (Agotada)</option>
        </select>
      </div>

      <div>
        <label for="telefono" class="block text-sm font-medium text-gray-700">Teléfono</label>
        <input type="tel" id="telefono" name="telefono" required
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
      </div>

      <div>
        <label for="emergencia" class="block text-sm font-medium text-gray-700">Contacto de Emergencia</label>
        <input type="tel" id="emergencia" name="emergencia" required
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
      </div>

      <div class="text-center">
        <button type="button" id="btnRegistrar"
          class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition">Registrar</button>
      </div>
    </form>

    <!-- Modal de confirmación -->
    <div id="confirmModal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white p-6 rounded shadow-lg max-w-md w-full text-center">
        <h2 class="text-xl font-bold mb-4">Confirmar registro</h2>
        <p class="mb-4">¿Estás seguro de que los datos ingresados son correctos?</p>
        <div class="flex justify-center space-x-4">
          <button id="cancelarBtn" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Cancelar</button>
          <button id="confirmarBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Confirmar</button>
        </div>
      </div>
    </div>

    <!-- Mensaje animado -->
    <div id="mensajeExito" class="hidden text-center mt-6 text-green-700 font-bold text-xl animate-bounce">
      🎉 ¡Registro exitoso!
    </div>
  </div>

  <!-- Contacto -->
  <footer class="mt-10 text-center text-gray-600">
    <p>Organiza: Recreativa MTB Las Mercedes de Grecia</p>
    <p>
      <a href="https://www.facebook.com/p/Recreativa-MTB-Las-Mercedes-de-Grecia-100083199797371/"
        target="_blank" class="text-green-700 hover:underline">Visítanos en Facebook</a>
    </p>
  </footer>

  <script>
    const SUPABASE_URL = "https://eezlcugfzentosdtgvee.supabase.co";
    const SUPABASE_API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVlemxjdWdmemVudG9zZHRndmVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5MzczMjMsImV4cCI6MjA2NzUxMzMyM30.j4mmBxec_44Um9lgGAlCvYrVzRw2DYtj-QxLxQqX18I";

    const btnRegistrar = document.getElementById("btnRegistrar");
    const confirmModal = document.getElementById("confirmModal");
    const cancelarBtn = document.getElementById("cancelarBtn");
    const confirmarBtn = document.getElementById("confirmarBtn");
    const mensajeExito = document.getElementById("mensajeExito");
    const registroForm = document.getElementById("registroForm");

    // Validar formato de cédula
    document.getElementById("cedula").addEventListener("input", function (e) {
      let valor = e.target.value.replace(/\D/g, "");
      if (valor.length > 9) valor = valor.slice(0, 9);
      let formateado = "";
      if (valor.length > 0) formateado = valor[0];
      if (valor.length > 1) formateado += "-" + valor.slice(1, 5);
      if (valor.length > 5) formateado += "-" + valor.slice(5, 9);
      e.target.value = formateado;
    });

    btnRegistrar.addEventListener("click", () => {
      confirmModal.classList.remove("hidden");
    });

    cancelarBtn.addEventListener("click", () => {
      confirmModal.classList.add("hidden");
    });

    confirmarBtn.addEventListener("click", async () => {
      confirmModal.classList.add("hidden");

      const datos = {
        nombre: document.getElementById("nombre").value,
        apellidos: document.getElementById("apellidos").value,
        cedula: document.getElementById("cedula").value,
        sexo: document.getElementById("sexo").value,
        talla: document.getElementById("talla").value,
        telefono: document.getElementById("telefono").value,
        emergencia: document.getElementById("emergencia").value,
      };

      try {
        const res = await fetch(`${SUPABASE_URL}/rest/v1/inscripciones`, {
          method: "POST",
          headers: {
            apikey: SUPABASE_API_KEY,
            Authorization: `Bearer ${SUPABASE_API_KEY}`,
            "Content-Type": "application/json",
            Prefer: "return=representation"
          },
          body: JSON.stringify(datos)
        });

        if (!res.ok) throw new Error("Error al registrar");

        mensajeExito.classList.remove("hidden");
        confetti();
        registroForm.reset();

        setTimeout(() => {
          mensajeExito.classList.add("hidden");
        }, 4000);

      } catch (error) {
        alert("Ocurrió un error al enviar la inscripción");
        console.error(error);
      }
    });
  </script>
</body>
</html>

